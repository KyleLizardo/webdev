<!doctype html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="assist.css">
    <link href="https://cdn.jsdelivr.net/npm/remixicon@4.2.0/fonts/remixicon.css" rel="stylesheet">
    <link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet">
    <script src="assist.js" defer></script>
    <title>Hello, world!</title>
</head>

<body>
    <nav>
        <div class="nav_content">
            <div class="logo"><a href="#"><img class="BHLU-logo" src="/LOGO1.png" alt="BHLU Logo"></a></div>
            <label for="check" class="checkbox"><i class="ri-menu-line"></i></label>
            <input type="checkbox" name="check" id="check">
            <ul>
                <li><a href="#"><i class="ri-thumb-up-line"></i></a></li>
                <li><a href="#personal-container"><i class="ri-service-line"></i></a></li>
                <li><a id="signoutbtn">Sign Out</a></li>
            </ul>
        </div>
    </nav>

    <!-- main -->
    <main>
        <section id="form-container">
            <div id="message-container">
                <i id="close" class="ri-close-line btn" style="display: none;"></i>
                <input type="text" id="title-input" class="title-input" placeholder="Enter title" style="display: none;">
                <textarea id="request-textarea" class="textarea" placeholder="Enter your request..."></textarea>
                <div class="below-subj">
                    <i id="file" class='bx bxs-photo-album'></i>
                    <button type="post" id="post-btn" class="btn" style="display: none;">Post</button>
                </div>
            </div>
            <div id="personal-container">
                <h2 id="msg"></h2>
                <h2 id="greet"></h2>
                Hello
            </div>
        </section>
    </main>

    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.1/firebase-app.js";
        import { getDatabase, ref, set } from "https://www.gstatic.com/firebasejs/10.12.1/firebase-database.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.1/firebase-auth.js";

        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCiEZsjiaintF14Y0MB0lOjYCJRnIV8jqA",
            authDomain: "community-27dcf.firebaseapp.com",
            projectId: "community-27dcf",
            storageBucket: "community-27dcf.appspot.com",
            messagingSenderId: "888962297245",
            appId: "1:888962297245:web:1d3fe7d6f9b211526d9374",
            measurementId: "G-FP14CRMLTB"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const auth = getAuth(app);

        function AddData(userId) {
            const reqTitle = document.getElementById('title-input');
            const reqTxt = document.getElementById('request-textarea');

            console.log("Adding data for user: ", userId);
            set(ref(db, 'users/' + userId + '/posts/' + Date.now()), {
                title: reqTitle.value,
                content: reqTxt.value
            })
            .then(() => {
                alert("Data Added Successfully");
                console.log("Data added successfully");
            })
            .catch((error) => {
                alert("Unsuccessful: " + error.message);
                console.error("Error adding data: ", error);
            });
        }

        const postBtn = document.getElementById('post-btn');

        // Add a listener for the post button click event
        postBtn.addEventListener('click', () => {
            onAuthStateChanged(auth, (user) => {
                if (user) {
                    AddData(user.uid);
                } else {
                    console.log("User is not logged in");
                }
            });
        });
    </script>
</body>

</html>

<!DOCTYPE html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <link rel="stylesheet" href="userr.css">
    <script src="userr.js" defer></script>

    <title>Bayanihan</title>
</head>

<body>
    <div class="container">
        <div class="w-50 p-3 shadow rounded bg-white">
            <form id="PersonalForm">
                <h2 class="text-center mb-4">Register User</h2>
                <div class="form-row mb-3">
                    <div class="col">
                        <div class="form-floating">
                            <input type="text" class="form-control" id="fnameInp" placeholder="Enter First Name" required>
                            <label for="fnameInp">First Name</label>
                        </div>
                    </div>
                    <div class="col">
                        <div class="form-floating">
                            <input type="text" class="form-control" id="lnameInp" placeholder="Enter Last Name" required>
                            <label for="lnameInp">Last Name</label>
                        </div>
                    </div>
                </div>
                <div class="form-row mb-3">
                    <div class="col">
                        <div class="form-floating">
                            <input type="date" class="form-control" id="bdateInp" placeholder="Enter Date of Birth" required>
                            <label for="bdateInp">Date of Birth</label>
                        </div>
                    </div>
                    <div class="col">
                        <div class="form-floating">
                            <select class="form-select" id="genderInp" aria-label="Floating label select example" required>
                                <option value="" disabled selected hidden></option>
                                <option value="Male">Male</option>
                                <option value="Female">Female</option>
                                <option value="Other">Other</option>
                            </select>
                            <label for="genderInp">Gender</label>
                        </div>
                    </div>
                </div>
                <div class="form-row mb-3">
                    <div class="col">
                        <div class="form-floating">
                            <input type="tel" class="form-control" id="contactInp" placeholder="Contact Number" oninput="formatPhoneNumber(event)" required>
                            <label for="contactInp">Mobile Number</label>
                        </div>
                    </div>
                    <div class="col">
                        <div class="form-floating">
                            <input type="email" class="form-control" id="emailInp" placeholder="name@example.com" required>
                            <label for="emailInp">Email Address</label>
                        </div>
                    </div>
                </div>
                <div class="form-row mb-3">
                    <div class="col">
                        <div class="form-floating">
                            <input type="password" class="form-control" id="passwordInp" placeholder="Password" required>
                            <label for="passwordInp">Password</label>
                        </div>
                    </div>
                    <div class="col">
                        <div class="form-floating">
                            <input type="password" class="form-control" id="confirmPasswordInp" placeholder="Confirm Password" required>
                            <label for="confirmPasswordInp">Confirm Password</label>
                        </div>
                    </div>
                </div>
                <div class="form-row mb-3">
                    <div class="col">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="showPasswordCheck">
                            <label class="form-check-label" for="showPasswordCheck">Show Password</label>
                        </div>
                    </div>
                </div>
            </form>

            <form id="AddressForm">
                <h2 class="text-center mb-4">Address</h2>
                <div class="form-row mb-3">
                    <div class="col">
                        <div class="form-floating">
                            <input type="text" class="form-control" id="municipalityInp" name="municipality" placeholder="Enter Municipality" required>
                            <label for="municipalityInp">City/Municipality</label>
                        </div>
                    </div>
                </div>

                <div class="form-row mb-3">
                    <div class="col">
                        <div class="form-floating">
                            <input type="text" class="form-control" id="brgyInp" name="barangay" placeholder="Enter Barangay" required>
                            <label for="brgyInp">Barangay</label>
                        </div>
                    </div>
                </div>

                <div class="form-row mb-3">
                    <div class="col">
                        <div class="form-floating">
                            <input type="text" class="form-control" id="streetInp" name="street" placeholder="Enter Street" required>
                            <label for="streetInp">Street</label>
                        </div>
                    </div>
                </div>
                <div class="form-actions text-center mb-3">
                    <button type="submit" class="btn btn-primary w-50">Sign Up</button>
                </div>
                <div class="text-center">
                    Already have an account? <a href="login.html">Log In</a>
                </div>
            </form>
        </div>
    </div>

    <!-- Optional JavaScript; choose one of the two! -->
    <!-- Option 1: Bootstrap Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
        crossorigin="anonymous"></script>

    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.1/firebase-app.js";
        import { getDatabase, set, ref } from "https://www.gstatic.com/firebasejs/10.12.1/firebase-database.js";
        import { getAuth, createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.12.1/firebase-auth.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.12.1/firebase-analytics.js";

        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCiEZsjiaintF14Y0MB0lOjYCJRnIV8jqA",
            authDomain: "community-27dcf.firebaseapp.com",
            projectId: "community-27dcf",
            storageBucket: "community-27dcf.appspot.com",
            messagingSenderId: "888962297245",
            appId: "1:888962297245:web:1d3fe7d6f9b211526d9374",
            measurementId: "G-FP14CRMLTB"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getDatabase();
        const auth = getAuth(app);

        // Get references to the input fields
        const FnameInp = document.getElementById('fnameInp');
        const LnameInp = document.getElementById('lnameInp');
        const BdateInp = document.getElementById('bdateInp');
        const GenderInp = document.getElementById('genderInp');
        const ContactInp = document.getElementById('contactInp');
        const EmailInp = document.getElementById('emailInp');
        const PassInp = document.getElementById('passwordInp');
        const ConfirmPassInp = document.getElementById('confirmPasswordInp');
        const StreetInp = document.getElementById('streetInp');
        const BrgyInp = document.getElementById('brgyInp');
        const MunicipalityInp = document.getElementById('municipalityInp');
        const ShowPasswordCheck = document.getElementById('showPasswordCheck');

        // Function to handle form submission
        const RegisterUser = evt => {
            evt.preventDefault(); // Prevent any default behavior

            createUserWithEmailAndPassword(auth, EmailInp.value, PassInp.value)
                .then(credentials => {
                    const user = credentials.user;
                    return set(ref(db, 'users/' + user.uid), {
                        firstName: FnameInp.value,
                        lastName: LnameInp.value,
                        birthDate: BdateInp.value,
                        gender: GenderInp.value,
                        contact: ContactInp.value,
                        email: EmailInp.value,
                        street: StreetInp.value,
                        brgy: BrgyInp.value,
                        municipality: MunicipalityInp.value
                    })
                    .then(() => {
                        alert("User registered successfully!");
                        window.location.href = '../loginpage/login.html'; // Updated path
                    });
                })
                .catch(error => {
                    alert(error.message);
                    console.error("Error during registration: ", error.code, error.message);
                });
        };

        // Add event listener to the form id - PersonalForm
        document.getElementById('PersonalForm').addEventListener('submit', RegisterUser);
        document.getElementById('AddressForm').addEventListener('submit', RegisterUser);

        // Toggle password visibility
        ShowPasswordCheck.addEventListener('change', () => {
            const type = ShowPasswordCheck.checked ? 'text' : 'password';
            PassInp.type = type;
            ConfirmPassInp.type = type;
        });

        const analytics = getAnalytics(app);
    </script>
</body>
</html>
